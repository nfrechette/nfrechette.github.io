---
layout: post
title: "Animation Compression Library: Release 1.0.0"
---
The long awaited **ACL v1.0** release is finally [here](https://github.com/nfrechette/acl/releases/tag/v1.0.0)! And it comes with the brand new [Unreal Engine 4 plugin v0.1](https://github.com/nfrechette/acl-ue4-plugin/releases/tag/v0.1.0)! It took 15 months of late nights, days off, and weekends to reach this point and I couldn't be more pleased with the results.

# Recap

The core idea behind ACL was to explore a different way to perform animation compression, one that departed from classic methods. Unlike the vast majority of algorithms in the wild, it uses bit aligned values as opposed to naturally aligned integers. This is slower to unpack but I hoped to compensate by not performing any sort of key reduction. By retaining every sample, the data is uniform in memory and offsets are trivially calculated, keeping things fast, the memory touched contiguous, and the hardware happy. While the technique itself isn't novel and is often used with compression algorithms in other fields, to my knowledged it had never been tried to the extent ACL pushes it with animation compression.

Very early, the technique proved competitive and over time it emerged as a clear winner over traditional techniques involving key reduction. I then spent about 8 months writing the necessary infrastructure to make ACL not only production ready but production quality: unit tests were written, extensive regression tests were introduced, documentation was added as well as comments, scripts to replicate the results, cross platform support (ACL now runs on ***every*** platform!), etc. All that good stuff that one would expect from a professional product.

But don't take my word for it! Check out the **100% C++** code (*MIT license*), the statistics below, and take the plugin out for a spin!

# Performance

While ACL provides various synthetic test hardnesses to benchmark and extract statistics, nothing beats running it within a real game engine. This is where the UE4 plugin comes in and really shines. Just as with ACL, three data sets are measured: CMU, Paragon, and the Matinee fight scene.

*Note that there are small differences between measuring with the UE4 plugin and with the ACL test harnesses due to implementation choices in the plugin.*

## Carnegie-Mellon University (CMU)

|         | ACL Plugin v0.1.0 | UE 4.19.2 |
| ------- | -------- | -------- |
| **Compressed size**      | 70.60 MB | 99.94 MB |
| **Compression ratio**    | 20.25 : 1 | 14.30 : 1 |
| **Max error**            | 0.0703 cm | 0.1520 cm |
| **Compression time**     | 30m 38.75s | 1h 19m 59.44s |

ACL was smaller for **2532** clips (**99.92 %**)  
ACL was more accurate for **2524** clips (**99.61 %**)  
ACL has faster compression for **2534** clips (**100.00 %**)  
ACL was smaller, better, and faster for **2522** clips (**99.53 %**)  

Would the *ACL Plugin* have been included in the *Automatic Compression* permutations tried, it would have won for **2534** clips (**100.00 %**)

Data tracked [here](https://github.com/nfrechette/acl-ue4-plugin/blob/develop/Docs/cmu_performance.md) by the plugin, and [here](https://github.com/nfrechette/acl/blob/develop/docs/cmu_performance.md) by ACL.

## Paragon

|         | ACL Plugin v0.1.0 | UE 4.19.2 |
| ------- | -------- | -------- |
| **Compressed size**      | 220.75 MB | 392.97 MB |
| **Compression ratio**    | 19.37 : 1 | 10.88 : 1 |
| **Max error**            | 0.9457 cm | 0.8619 cm |
| **Compression time**     | 5h 51m 32.68s | 13h 43m 57.80s |

ACL was smaller for **6415** clips (**97.82 %**)  
ACL was more accurate for **5107** clips (**77.87 %**)  
ACL has faster compression for **5972** clips (**91.06 %**)  
ACL was smaller, better, and faster for **4645** clips (**70.83 %**)  

Would the *ACL Plugin* have been included in the *Automatic Compression* permutations tried, it would have won for **5766** clips (**87.92 %**)

Data tracked [here](https://github.com/nfrechette/acl-ue4-plugin/blob/develop/Docs/paragon_performance.md) by the plugin, and [here](https://github.com/nfrechette/acl/blob/develop/docs/paragon_performance.md) by ACL.

## Matinee fight scene

|         | ACL Plugin v0.1.0 | UE 4.19.2 |
| ------- | -------- | -------- |
| **Compressed size**      | 8.67 MB | 19.04 MB |
| **Compression ratio**    | 7.20 : 1 | 3.28 : 1 |
| **Max error**            | 0.067 cm | 0.161 cm |
| **Compression time**     | 1m 38.5s | 1h 29m 54.6s |

ACL was smaller for **1** clip (**20 %**)  
ACL was more accurate for **4** clips (**80 %**)  
ACL has faster compression for **5** clips (**100 %**)  
ACL was smaller, better, and faster for **1** clip (**20 %**)  

Would the *ACL Plugin* have been included in the *Automatic Compression* permutations tried, it would have won for **4** clips (**80 %**)

Data tracked [here](https://github.com/nfrechette/acl-ue4-plugin/blob/develop/Docs/fight_scene_performance.md) by the plugin, and [here](https://github.com/nfrechette/acl/blob/develop/docs/fight_scene_performance.md) by ACL.

## Decompression performance

TODO

## Performance summary

As the numbers clearly show, ACL beats UE4 across every metric, often by a significant margin: it is *MUCH* faster to compress and decompress, the quality is on par or higher, and the memory footprint is significantly reduced. And ACL achieves this with default settings that animators *never* need to tweak. What's not to love?

*And ACL is just getting started!*

# How to use the ACL Plugin

As the documentation states [here](https://github.com/nfrechette/acl-ue4-plugin/blob/develop/Docs/README.md), a few minor engine changes are required in order to support the ACL plugin. These changes mostly consist of bug fixes and changes to expose the necessary hooks to plugins.

For the time being, the plugin is not yet on the marketplace as it is not fully plug-and-play. However, this summer I am working with *Epic* to introduce the necessary changes in order to publish the ACL plugin on the marketplace. **Stay tuned!**

*Note that the ACL Plugin will reach **v1.0** once it can be published on the marketplace but it is production ready regardless.*

# What's new in ACL v1.0

Few things actually changed in between *v0.8* and *v1.0*. Most of the changes revolved around minor additions, documentation updates, etc. There is one notable change that is visible in the [decompression graphs](https://github.com/nfrechette/acl/blob/develop/docs/decompression_performance.md): we now yield the thread before measuring every sample. This helps ensure more stable results by reducing the likelihood that the kernel will swap out the thread and interrupt it while executing the decompression code.

My *Nexus 5X* continues to struggle and in this run the CPU often ran hot causing the thread to sometimes migrate to a slower core, tainting the results.

*VS2015* ended up slightly faster, perhaps due to a minor code change somewhere that changed how inlining happens.

*OS X* and *iOS* also appear to have regressed, perhaps due to a new version of *XCode*.

Regardless, the measuring should now be much more stable.

# What's next

The next release of ACL will focus on improving the [compression and decompression performance](https://github.com/nfrechette/acl/milestone/6). While ACL was built from the ground up to be fast to decompress; so far the focus has been on making sure things function properly and safely to establish a solid baseline to work with. Now that this work is done, the fun part can begin: making it the best it can be! I have many improvements planned and while some of them will make it in **v1.1**, others will have to wait for future versions.

Special care will be taken to make sure ACL performs at its best in UE4 but there is no reason why it couldn't be used in your own favorite game engine or animation middleware. Developing with UE4 is easier for me in large part because of my past experience with it, my relationship with *Epic*, and the fact that it is open source. Other game engines like Unity explicitly forbid their use for benchmarking purposes in their *EULA* which prevents me from publishing any results without prior written agreement form their legal departement. Furthermore, without access to the source code, creating a plugin for it requires a lot more work. In due time, I hope to support Unity, Godot, and anyone else willing to try it out.
